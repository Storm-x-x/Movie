<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Genius Video Player with Real Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ====== CSS Reset & Variables ====== */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
:root {
    --primary: #1a2a6c;
    --secondary: #b21f1f;
    --accent: #fdbb2d;
    --dark: rgba(25, 25, 40, 0.55);
    --darker: rgba(10, 10, 20, 0.6);
    --light: #ffffff;
    --blur: blur(18px);
}

/* ====== Background & Layout ====== */
html, body {
    height: 100%;
    overflow: hidden;
    background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
    background-size: 200% 200%;
    animation: gradientShift 10s ease infinite;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    width: 100%;
    height: 100%;
}

/* ====== Frosted Glass Containers ====== */
.container {
    width: 100%;
    max-width: 1200px;
    height: 95vh;
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 16px;
    backdrop-filter: var(--blur);
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.15);
    overflow: hidden;
}

/* ====== Video Container ====== */
.video-container {
    flex: 1;
    border-radius: 16px;
    overflow: hidden;
    backdrop-filter: var(--blur);
    background: rgba(0,0,0,0.35);
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
    transition: all 0.4s ease;
}
.video-container:hover {
    box-shadow: 0 0 40px rgba(253,187,45,0.3);
    transform: scale(1.01);
}

.video-header {
    padding: 10px 16px;
    background: rgba(255,255,255,0.05);
    backdrop-filter: var(--blur);
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--light);
    font-weight: 600;
}
.video-title { font-size: 1rem; }
.video-status { font-size: 0.8rem; opacity: 0.8; }

.video-wrapper {
    flex: 1;
    position: relative;
    background: #000;
}
video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    background-color: #000;
}

.loading-spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255,255,255,0.3);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: none;
}
@keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }

/* ====== Video Controls ====== */
.video-controls {
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(12px);
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
}
.play-btn, .fullscreen-btn {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: var(--light);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.25s;
}
.play-btn:hover, .fullscreen-btn:hover {
    background: var(--accent);
    color: var(--dark);
    transform: scale(1.1);
}

.progress-container {
    flex-grow: 1;
    height: 5px;
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
    position: relative;
    cursor: pointer;
}
.progress-bar {
    height: 100%;
    background: var(--accent);
    width: 0%;
    border-radius: 3px;
    box-shadow: 0 0 6px var(--accent);
}
.time-display {
    font-size: 0.8rem;
    color: var(--light);
}
.volume-control {
    display: flex;
    align-items: center;
    gap: 6px;
}
.volume-icon { color: var(--light); }
.volume-slider {
    width: 60px;
    height: 4px;
    background: rgba(255,255,255,0.15);
    border-radius: 2px;
    position: relative;
}
.volume-level {
    height: 100%;
    background: var(--accent);
    width: 80%;
    border-radius: 2px;
}

/* ====== Chat Container ====== */
.chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    border-radius: 16px;
    overflow: hidden;
    backdrop-filter: var(--blur);
    background: rgba(20,20,30,0.6);
    box-shadow: inset 0 0 20px rgba(255,255,255,0.05);
}

.chat-header {
    padding: 12px 16px;
    background: rgba(255,255,255,0.07);
    color: var(--light);
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.online-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
}
.online-dot {
    width: 8px;
    height: 8px;
    background: #4CAF50;
    border-radius: 50%;
    box-shadow: 0 0 8px #4CAF50;
}

.chat-messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.message {
    max-width: 85%;
    padding: 8px 12px;
    border-radius: 14px;
    line-height: 1.4;
    font-size: 0.85rem;
    word-wrap: break-word;
    backdrop-filter: blur(10px);
    transition: all 0.2s;
}
.message.received {
    align-self: flex-start;
    background: rgba(255,255,255,0.1);
    color: var(--light);
    border-left: 2px solid var(--accent);
}
.message.sent {
    align-self: flex-end;
    background: rgba(253,187,45,0.2);
    color: #fffbe6;
    border-right: 2px solid var(--accent);
}
.message-sender {
    font-weight: 600;
    font-size: 0.75rem;
    margin-bottom: 2px;
}
.message-time {
    font-size: 0.65rem;
    opacity: 0.8;
    margin-top: 4px;
    text-align: right;
}
.reply-indicator {
    border-left: 2px solid var(--accent);
    padding-left: 8px;
    font-size: 0.75rem;
    opacity: 0.85;
    margin-bottom: 4px;
}
.reply-sender { font-weight: bold; }

/* ====== Chat Input ====== */
.chat-input-container {
    background: rgba(255,255,255,0.08);
    padding: 10px 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.chat-input {
    flex: 1;
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 20px;
    color: var(--light);
    padding: 8px 12px;
    outline: none;
    font-size: 0.9rem;
    backdrop-filter: blur(8px);
}
.send-btn {
    background: var(--accent);
    border: none;
    color: var(--dark);
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.25s;
}
.send-btn:hover {
    transform: scale(1.1);
    background: #ffcf4f;
}

/* ====== Login Modal ====== */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(8px);
}
.login-modal {
    background: rgba(30,30,50,0.7);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 16px;
    padding: 20px;
    max-width: 340px;
    width: 90%;
    color: var(--light);
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}
.login-title {
    text-align: center;
    font-size: 1.3rem;
    margin-bottom: 14px;
}
.form-input {
    padding: 10px;
    border-radius: 10px;
    border: none;
    outline: none;
    background: rgba(255,255,255,0.1);
    color: var(--light);
}
.login-btn {
    background: var(--accent);
    color: var(--dark);
    border: none;
    border-radius: 10px;
    padding: 10px;
    margin-top: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.25s;
}
.login-btn:hover { background: #ffcf4f; }

/* ====== Responsive ====== */
@media (min-width: 992px) {
    .container {
        flex-direction: row;
    }
    .video-container { flex: 2; }
    .chat-container { flex: 1; }
}
</style>
</head>
<body>

<!-- Login Modal -->
<div class="modal-overlay" id="loginModal">
  <div class="login-modal">
    <h2 class="login-title">Join the Chat</h2>
    <form id="loginForm">
      <input type="text" class="form-input" id="username" placeholder="Enter your name" required autofocus>
      <button type="submit" class="login-btn">Join Chat</button>
    </form>
  </div>
</div>

<!-- Main Content -->
<div class="container" id="mainContainer" style="display:none;">
  <div class="video-container">
    <div class="video-header">
      <div class="video-title">Genius Video Player</div>
      <div class="video-status">Ready to play</div>
    </div>
    <div class="video-wrapper">
      <video id="videoPlayer">
        <source src="http://172.174.228.24:8089/video" type="video/mp4">
        Your browser does not support video.
      </video>
      <div class="loading-spinner" id="loadingSpinner"></div>
    </div>
    <div class="video-controls">
      <button class="play-btn" id="playBtn"><i class="fas fa-play"></i></button>
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
      <div class="volume-control">
        <div class="volume-icon"><i class="fas fa-volume-up"></i></div>
        <div class="volume-slider" id="volumeSlider">
          <div class="volume-level" id="volumeLevel"></div>
        </div>
      </div>
      <button class="fullscreen-btn" id="fullscreenBtn"><i class="fas fa-expand"></i></button>
    </div>
  </div>

  <div class="chat-container">
    <div class="chat-header">
      <span>Chat Room - <span id="userNameDisplay">User</span></span>
      <div class="online-indicator">
        <div class="online-dot"></div>
        <span id="onlineCount">1 Online</span>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Type your message...">
      <button class="send-btn" id="sendBtn"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const loginModal = document.getElementById("loginModal");
  const mainContainer = document.getElementById("mainContainer");
  const loginForm = document.getElementById("loginForm");
  const usernameInput = document.getElementById("username");
  const userNameDisplay = document.getElementById("userNameDisplay");
  const onlineCount = document.getElementById("onlineCount");
  const chatMessages = document.getElementById("chatMessages");
  const chatInput = document.getElementById("chatInput");
  const sendBtn = document.getElementById("sendBtn");
  const video = document.getElementById("videoPlayer");
  const playBtn = document.getElementById("playBtn");
  const progressContainer = document.getElementById("progressContainer");
  const progressBar = document.getElementById("progressBar");
  const timeDisplay = document.getElementById("timeDisplay");
  const volumeSlider = document.getElementById("volumeSlider");
  const volumeLevel = document.getElementById("volumeLevel");
  const fullscreenBtn = document.getElementById("fullscreenBtn");
  const loadingSpinner = document.getElementById("loadingSpinner");
  const videoStatus = document.querySelector(".video-status");

  const socket = io();
  let currentUser = "";

  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const username = usernameInput.value.trim();
    if (!username) return;
    currentUser = username;
    userNameDisplay.textContent = username;
    loginModal.style.display = "none";
    mainContainer.style.display = "flex";
    socket.emit("join", username);
  });

  function sendMessage() {
    const msg = chatInput.value.trim();
    if (!msg) return;
    socket.emit("chatMessage", msg);
    chatInput.value = "";
  }
  sendBtn.addEventListener("click", sendMessage);
  chatInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });

  socket.on("message", ({ sender, text }) => {
    const msgDiv = document.createElement("div");
    msgDiv.classList.add("message", sender === currentUser ? "sent" : "received");
    const now = new Date();
    const time = `${now.getHours()}:${String(now.getMinutes()).padStart(2, "0")}`;
    msgDiv.innerHTML = `<div class="message-sender">${sender}</div><div>${text}</div><div class="message-time">${time}</div>`;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  });

  socket.on("onlineCount", (count) => {
    onlineCount.textContent = `${count} Online`;
  });

  playBtn.addEventListener("click", togglePlay);
  video.addEventListener("click", togglePlay);
  function togglePlay() {
    if (video.paused) { video.play(); playBtn.innerHTML = '<i class="fas fa-pause"></i>'; }
    else { video.pause(); playBtn.innerHTML = '<i class="fas fa-play"></i>'; }
  }

  video.addEventListener("timeupdate", () => {
    if (video.duration) {
      const percent = (video.currentTime / video.duration) * 100;
      progressBar.style.width = `${percent}%`;
      const fmt = (t) => `${Math.floor(t / 60)}:${String(Math.floor(t % 60)).padStart(2, "0")}`;
      timeDisplay.textContent = `${fmt(video.currentTime)} / ${fmt(video.duration)}`;
    }
  });

  progressContainer.addEventListener("click", (e) => {
    video.currentTime = (e.offsetX / progressContainer.clientWidth) * video.duration;
  });

  volumeSlider.addEventListener("click", (e) => {
    video.volume = e.offsetX / volumeSlider.clientWidth;
    volumeLevel.style.width = `${video.volume * 100}%`;
  });

  fullscreenBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) video.requestFullscreen(); else document.exitFullscreen();
  });

  video.addEventListener("waiting", () => { loadingSpinner.style.display = "block"; videoStatus.textContent = "Buffering..."; });
  video.addEventListener("playing", () => { loadingSpinner.style.display = "none"; videoStatus.textContent = "Playing"; });
  video.addEventListener("pause", () => { videoStatus.textContent = "Paused"; });
});
</script>
</body>
</html>
