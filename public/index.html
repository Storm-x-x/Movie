<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Genius Player — Android App Style</title>

<!-- Icons / Font -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* -------------------------
   Android-App Look & Feel
   ------------------------- */
:root{
  --bg1: #0b1020;
  --bg2: #0f1a2f;
  --glass: rgba(255,255,255,0.04);
  --glass-strong: rgba(255,255,255,0.06);
  --accent: #ffd54a;      /* golden accent */
  --accent-2: #ffb74d;
  --muted: rgba(255,255,255,0.75);
  --card-radius: 18px;
  --blur: 14px;
  --safe-top: env(safe-area-inset-top, 12px);
  --safe-bottom: env(safe-area-inset-bottom, 12px);
  --ui-scale: 1;
}

/* Reset */
*{box-sizing:border-box; margin:0; padding:0; font-family: 'Roboto', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
html,body{height:100%; background: linear-gradient(180deg,var(--bg1), var(--bg2)); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; -webkit-tap-highlight-color:transparent;}
body{display:flex; align-items:flex-start; justify-content:center; padding:calc(16px + var(--safe-top)) 12px calc(12px + var(--safe-bottom)); }

/* App shell */
.app {
  width:100%;
  max-width:900px;
  height:calc(100vh - (var(--safe-top) + var(--safe-bottom) + 24px));
  border-radius:18px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
  box-shadow: 0 12px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.03);
}

/* Top status bar (android style) */
.topbar {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px;
  gap:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  backdrop-filter: blur(6px);
}
.app-title { display:flex; align-items:center; gap:8px; color:var(--muted); font-weight:500; font-size:15px; }
.app-title .dot { width:10px; height:10px; background:var(--accent); border-radius:50%; box-shadow:0 0 10px rgba(255,213,74,0.25); }
.top-actions { color:var(--muted); display:flex; gap:10px; align-items:center; }

/* Content area */
.content {
  display:flex;
  flex:1;
  gap:12px;
  padding:12px;
}

/* Video card (primary) */
.player {
  flex:2;
  min-height:120px;
  border-radius:calc(var(--card-radius) - 4px);
  overflow:hidden;
  position:relative;
  background: linear-gradient(180deg, rgba(10,10,18,0.55), rgba(0,0,0,0.6));
  border: 1px solid rgba(255,255,255,0.03);
  backdrop-filter: blur(var(--blur));
  display:flex;
  flex-direction:column;
}
.player .meta {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px;
  color:var(--muted); font-weight:600;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
}
.player .meta .title { font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:70%; }

/* Video view */
.video-area {
  position:relative; flex:1; background:#000; display:flex; align-items:center; justify-content:center;
}
.video-area video {
  width:100%; height:100%; object-fit:contain; display:block; background:#000;
  -webkit-user-select:none; user-select:none;
}

/* overlay controls container (hidden/shown) */
.controls {
  position:absolute; left:0; right:0; bottom:0; padding:12px; display:flex; flex-direction:column; gap:12px;
  pointer-events:none; /* buttons enable via child */
}
.controls .row { display:flex; align-items:center; gap:10px; pointer-events:auto; }

/* progress large */
.progress {
  height:8px; border-radius:999px; background: rgba(255,255,255,0.06); overflow:hidden; flex:1;
  box-shadow: inset 0 -1px 6px rgba(0,0,0,0.6);
}
.progress .bar { height:100%; width:0%; background:linear-gradient(90deg,var(--accent), var(--accent-2)); box-shadow:0 6px 18px rgba(255,180,60,0.12); transition:width .07s linear; }

/* big playback buttons */
.fab-row { display:flex; align-items:center; gap:10px; justify-content:center; }
.fab {
  width:64px; height:64px; border-radius:50%; display:flex; align-items:center; justify-content:center;
  background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.88));
  color:var(--bg2); box-shadow: 0 10px 30px rgba(0,0,0,0.5); border:none; cursor:pointer; font-size:20px; transition:transform .12s;
}
.fab.primary { background: linear-gradient(180deg, var(--accent), var(--accent-2)); color:#101018; box-shadow: 0 10px 32px rgba(255,180,60,0.16); }
.fab:active{ transform:scale(.98); }

/* touch hit for small icons */
.icon-btn { width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.03); color:var(--muted); border:none; cursor:pointer; }

/* Right column — small overlay info or desktop chat trigger */
.side {
  flex:1; min-width:260px; border-radius:calc(var(--card-radius) - 4px);
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
  border: 1px solid rgba(255,255,255,0.03);
  padding:10px; display:flex; flex-direction:column; gap:10px; backdrop-filter: blur(10px);
}
.side .section-title { color:var(--muted); font-weight:700; font-size:13px; }
.side .mini { background: rgba(0,0,0,0.35); padding:10px; border-radius:12px; color:var(--muted); font-size:13px; }

/* Bottom sheet chat (Android style) */
.chat-sheet {
  position: absolute; left:0; right:0; bottom:0; height:60vh; max-height:92vh;
  transform: translateY(100%); transition: transform .3s cubic-bezier(.2,.9,.2,1);
  border-top-left-radius:20px; border-top-right-radius:20px;
  background: linear-gradient(180deg, rgba(10,10,18,0.92), rgba(6,8,12,0.96));
  box-shadow: 0 -20px 40px rgba(0,0,0,0.6); z-index:60; overflow:hidden;
  display:flex; flex-direction:column;
  -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.03);
}
.chat-sheet.open { transform: translateY(0%); }
.chat-sheet .grab { width:44px; height:6px; background: rgba(255,255,255,0.06); border-radius:6px; margin:10px auto; }
.chat-sheet .header { padding:8px 14px; display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-weight:700; }
.chat-body { padding:10px; overflow:auto; display:flex; flex-direction:column; gap:10px; flex:1; }
.chat-row { max-width:86%; padding:8px 12px; border-radius:14px; background: rgba(255,255,255,0.04); color:var(--muted); align-self:flex-start; }
.chat-row.me { align-self:flex-end; background: linear-gradient(90deg, rgba(255,213,74,0.12), rgba(255,187,80,0.06)); color:#fffbe6; }

/* chat input inside sheet */
.chat-input-wrap { display:flex; gap:8px; padding:10px; border-top:1px solid rgba(255,255,255,0.02); background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); }
.chat-input-wrap input { flex:1; padding:10px 12px; border-radius:999px; border:none; outline:none; background:rgba(255,255,255,0.03); color:var(--muted); }
.chat-input-wrap button { width:48px; height:48px; border-radius:50%; border:none; background:var(--accent); color:#111; cursor:pointer; }

/* Login overlay */
.modal-overlay { position:fixed; inset:0; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.7)); display:flex; align-items:center; justify-content:center; z-index:120; }
.login-card { width:92%; max-width:420px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px; border-radius:14px; color:var(--muted); border:1px solid rgba(255,255,255,0.03); }
.login-card h2{ font-size:20px; margin-bottom:10px; }
.login-card input { width:100%; padding:12px; border-radius:10px; border:none; outline:none; background:rgba(255,255,255,0.02); color:var(--muted); margin-bottom:10px;}
.login-card button { width:100%; padding:12px; border-radius:10px; border:none; background:var(--accent); color:#111; font-weight:700; cursor:pointer; }

/* small helpers */
.small { font-size:12px; color:rgba(255,255,255,0.7); }
.center { display:flex; align-items:center; justify-content:center; }

/* responsive: mobile stacks */
@media (max-width:900px) {
  .content { flex-direction:column; padding:8px; gap:10px; }
  .side { order:99; min-height:0; }
  .player { order:1; min-height:300px; }
  .chat-sheet { height:78vh; }
}
</style>
</head>
<body>

<!-- LOGIN / ONBOARD -->
<div id="loginModal" class="modal-overlay">
  <div class="login-card" role="dialog" aria-modal="true">
    <h2>Welcome — Join Chat</h2>
    <input id="usernameInput" type="text" placeholder="Enter display name" maxlength="30" />
    <button id="joinBtn">Enter App</button>
  </div>
</div>

<!-- APP SHELL -->
<div class="app" id="app" aria-hidden="true">

  <!-- Topbar (android style) -->
  <div class="topbar">
    <div class="app-title"><span class="dot"></span> Genius Player</div>
    <div class="top-actions">
      <button id="toggleChatBtn" class="icon-btn" title="Chat"><i class="fas fa-comments"></i></button>
      <button id="castBtn" class="icon-btn" title="Cast"><i class="fas fa-tv"></i></button>
      <button id="settingsBtn" class="icon-btn" title="Settings"><i class="fas fa-gear"></i></button>
    </div>
  </div>

  <!-- Content -->
  <div class="content">

    <!-- Player -->
    <div class="player" id="playerCard">
      <div class="meta">
        <div class="title" id="videoTitle">Genius Video Player • Android UI</div>
        <div class="small" id="videoStatus">Ready</div>
      </div>

      <div class="video-area" id="videoArea">
        <!-- Video element -->
        <video id="video"
               playsinline
               webkit-playsinline
               crossorigin="anonymous"
               preload="metadata"
               poster=""
               src="http://172.174.228.24:8089/video">
          Your browser doesn't support the video tag.
        </video>

        <!-- central overlay big play on idle -->
        <div id="centerPlay" class="center" style="position:absolute; inset:0; pointer-events:none;">
          <button id="centerFab" class="fab primary" style="pointer-events:auto; opacity:0.98;"><i class="fas fa-play"></i></button>
        </div>

        <!-- Controls overlay (bottom) -->
        <div class="controls" id="controls">
          <div class="row">
            <div class="icon-btn" id="rewBtn" title="Rewind 10s"><i class="fas fa-rotate-left"></i></div>
            <div class="icon-btn" id="ffBtn" title="Forward 10s"><i class="fas fa-rotate-right"></i></div>
            <div class="progress" id="progressBarWrap" aria-hidden="false">
              <div class="bar" id="progressBar"></div>
            </div>
            <div class="small" id="timeLabel">0:00 / 0:00</div>
          </div>

          <div class="row fab-row">
            <button class="fab" id="skipBack"><i class="fas fa-backward"></i></button>
            <button class="fab primary" id="playBtnLarge" title="Play/Pause"><i class="fas fa-play"></i></button>
            <button class="fab" id="skipNext"><i class="fas fa-forward"></i></button>
          </div>

        </div> <!-- controls -->

        <!-- loading spinner -->
        <div id="spinner" style="position:absolute; left:calc(50% - 28px); top:calc(50% - 28px); width:56px; height:56px; border-radius:50%; border:5px solid rgba(255,255,255,0.08); border-top-color:var(--accent); animation:spin 1s linear infinite; display:none;"></div>

      </div> <!-- video-area -->
    </div> <!-- player -->

    <!-- Side column (info & quick actions) -->
    <div class="side">
      <div class="section-title">Now Playing</div>
      <div class="mini">
        <div id="nowPlayingText">Genius Live Stream</div>
        <div class="small" style="margin-top:6px;">Tap video to play/pause. Double-tap left/right to skip 10s. Pull up chat below.</div>
      </div>

      <div class="section-title">Quick Controls</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="icon-btn" id="muteBtn" title="Mute/Unmute"><i class="fas fa-volume-high"></i></button>
        <button class="icon-btn" id="qualityBtn" title="Quality"><i class="fas fa-layer-group"></i></button>
        <button class="icon-btn" id="downloadBtn" title="Download"><i class="fas fa-download"></i></button>
      </div>

      <div style="margin-top:auto;">
        <div class="section-title">Device</div>
        <div class="mini">Android-style UI • Touch optimized • Full-screen capable</div>
      </div>
    </div>

  </div> <!-- content -->

  <!-- Chat bottom sheet -->
  <div class="chat-sheet" id="chatSheet" aria-hidden="true">
    <div class="grab"></div>
    <div class="header">
      <div>Live Chat</div>
      <div class="small"><span id="onlineCount">1</span> online</div>
    </div>

    <div class="chat-body" id="chatBody">
      <!-- messages injected here -->
    </div>

    <div class="chat-input-wrap">
      <input id="chatInput" type="text" placeholder="Say something..." />
      <button id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

</div> <!-- app -->

<!-- Socket.io (if available on server) -->
<script src="/socket.io/socket.io.js"></script>

<script>
/* -------------------------
   App Script (single-file)
   ------------------------- */

(() => {
  // Elements
  const loginModal = document.getElementById('loginModal');
  const joinBtn = document.getElementById('joinBtn');
  const usernameInput = document.getElementById('usernameInput');
  const app = document.getElementById('app');
  const video = document.getElementById('video');
  const playBtnLarge = document.getElementById('playBtnLarge');
  const centerFab = document.getElementById('centerFab');
  const spinner = document.getElementById('spinner');
  const progressBar = document.getElementById('progressBar');
  const progressBarWrap = document.getElementById('progressBarWrap');
  const timeLabel = document.getElementById('timeLabel');
  const chatSheet = document.getElementById('chatSheet');
  const toggleChatBtn = document.getElementById('toggleChatBtn');
  const chatBody = document.getElementById('chatBody');
  const chatInput = document.getElementById('chatInput');
  const sendChatBtn = document.getElementById('sendChatBtn');
  const onlineCountEl = document.getElementById('onlineCount');
  const videoStatus = document.getElementById('videoStatus');
  const centerPlayContainer = document.getElementById('centerPlay');

  // optional socket (if server available)
  let socket;
  try { socket = io(); } catch(e){ socket = null; }

  // state
  let username = '';
  let isChatOpen = false;
  let dragging = false;
  let lastTap = 0;

  // Utilities
  function fmtTime(t) {
    if (isNaN(t) || !isFinite(t)) return '0:00';
    const m = Math.floor(t / 60);
    const s = Math.floor(t % 60);
    return m + ':' + String(s).padStart(2, '0');
  }

  // LOGIN flow
  joinBtn.addEventListener('click', () => {
    const val = usernameInput.value.trim() || ('User' + Math.floor(Math.random()*999));
    username = val;
    loginModal.style.display = 'none';
    app.setAttribute('aria-hidden', 'false');
    if (socket) socket.emit('join', username);
  });

  // Play/Pause
  function updatePlayUI(){
    if (video.paused) {
      playBtnLarge.innerHTML = '<i class="fas fa-play"></i>';
      centerFab.innerHTML = '<i class="fas fa-play"></i>';
      centerPlayContainer.style.display = 'flex';
    } else {
      playBtnLarge.innerHTML = '<i class="fas fa-pause"></i>';
      centerFab.innerHTML = '<i class="fas fa-pause"></i>';
      centerPlayContainer.style.display = 'none';
    }
  }
  function togglePlay(){
    if (video.paused) {
      video.play().catch(()=>{ /* autoplay blocked */ });
    } else video.pause();
    updatePlayUI();
  }
  playBtnLarge.addEventListener('click', togglePlay);
  centerFab.addEventListener('click', togglePlay);

  // Video events
  video.addEventListener('waiting', ()=> { spinner.style.display='block'; videoStatus.innerText = 'Buffering...'; });
  video.addEventListener('playing', ()=> { spinner.style.display='none'; videoStatus.innerText = 'Playing'; updatePlayUI(); });
  video.addEventListener('pause', ()=> { videoStatus.innerText = 'Paused'; updatePlayUI(); });
  video.addEventListener('loadedmetadata', ()=> {
    timeLabel.innerText = fmtTime(0) + ' / ' + fmtTime(video.duration);
  });

  // timeupdate -> progress
  video.addEventListener('timeupdate', ()=> {
    if (!video.duration) return;
    const pct = (video.currentTime / video.duration) * 100;
    progressBar.style.width = pct + '%';
    timeLabel.innerText = fmtTime(video.currentTime) + ' / ' + fmtTime(video.duration);
  });

  // click to seek on progress
  progressBarWrap.addEventListener('click', (ev) => {
    const rect = progressBarWrap.getBoundingClientRect();
    const x = (ev.clientX - rect.left);
    const pct = Math.min(1, Math.max(0, x / rect.width));
    if (video.duration) video.currentTime = pct * video.duration;
  });

  // double-tap gesture for skipping and single tap toggle controls
  document.getElementById('videoArea').addEventListener('click', (ev) => {
    const now = Date.now();
    const dt = now - lastTap;
    lastTap = now;
    // determine touch X to decide left/right
    const rect = ev.currentTarget.getBoundingClientRect();
    const x = ev.clientX - rect.left;
    if (dt < 300) {
      // double-tap
      if (x < rect.width / 2) { video.currentTime = Math.max(0, video.currentTime - 10); flashHint('-10s'); }
      else { video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 10); flashHint('+10s'); }
    } else {
      // single tap toggles play
      // small delay to ensure not double-counting
      setTimeout(()=>{
        if (Date.now() - lastTap >= 250) togglePlay();
      }, 260);
    }
  });

  // Double small skip buttons
  document.getElementById('rewBtn').addEventListener('click', ()=> { video.currentTime = Math.max(0, video.currentTime - 10); });
  document.getElementById('ffBtn').addEventListener('click', ()=> { video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 10); });
  document.getElementById('skipBack').addEventListener('click', ()=> { video.currentTime = Math.max(0, video.currentTime - 15); });
  document.getElementById('skipNext').addEventListener('click', ()=> { video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 15); });

  // Fullscreen on double-tap two-fingers? also support fullscreen button via long-press on center fab
  centerFab.addEventListener('contextmenu', (e)=>{ e.preventDefault(); toggleFullscreen(); });

  function toggleFullscreen(){
    const el = document.documentElement;
    if (!document.fullscreenElement) {
      const p = document.getElementById('app');
      if (p.requestFullscreen) p.requestFullscreen(); else if (p.webkitRequestFullscreen) p.webkitRequestFullscreen();
    } else {
      if (document.exitFullscreen) document.exitFullscreen();
    }
  }

  // small flash hint on skip
  function flashHint(txt){
    let hint = document.createElement('div'); hint.style.position='absolute';
    hint.style.left='50%'; hint.style.top='30%'; hint.style.transform='translateX(-50%)';
    hint.style.padding='10px 14px'; hint.style.borderRadius='8px';
    hint.style.background='rgba(0,0,0,0.6)'; hint.style.color='white'; hint.style.fontWeight='700';
    hint.style.zIndex=999; hint.innerText=txt; hint.style.opacity='0'; hint.style.transition='all .25s';
    document.getElementById('videoArea').appendChild(hint);
    requestAnimationFrame(()=>{ hint.style.opacity='1'; hint.style.transform='translateX(-50%) translateY(-6px)'; });
    setTimeout(()=>{ hint.style.opacity='0'; hint.style.transform='translateX(-50%) translateY(-20px)'; setTimeout(()=>hint.remove(),260); },700);
  }

  // Chat sheet open/close & drag
  toggleChatBtn.addEventListener('click', ()=> toggleChat());
  function toggleChat(open) {
    isChatOpen = typeof open === 'boolean' ? open : !isChatOpen;
    chatSheet.classList.toggle('open', isChatOpen);
    chatSheet.setAttribute('aria-hidden', !isChatOpen);
  }

  // Dragging the sheet (touch)
  let startY = 0, startTrans = 0, sheetH = 0;
  chatSheet.addEventListener('touchstart', (e)=>{
    dragging = true; startY = e.touches[0].clientY; sheetH = chatSheet.getBoundingClientRect().height;
    chatSheet.style.transition = 'none';
    startTrans = chatSheet.classList.contains('open') ? 0 : 1;
  });
  chatSheet.addEventListener('touchmove', (e)=>{
    if (!dragging) return;
    const dy = e.touches[0].clientY - startY;
    const pct = Math.min(Math.max(dy / sheetH, -1), 1); // negative = dragging up
    const t = startTrans + (pct);
    const translate = Math.min(1, Math.max(0, 1 - t)); // map to 0..1 where 1 = closed
    chatSheet.style.transform = `translateY(${translate * 100}%)`;
  });
  chatSheet.addEventListener('touchend', (e)=>{
    dragging = false;
    chatSheet.style.transition = '';
    const rect = chatSheet.getBoundingClientRect();
    const visible = (window.innerHeight - rect.top) / rect.height;
    toggleChat(visible > 0.45);
  });

  // Send chat
  function appendChat(sender, text, me=false){
    const r = document.createElement('div');
    r.className = 'chat-row' + (me ? ' me' : '');
    r.innerHTML = `<div style="font-weight:700; font-size:13px; margin-bottom:6px;">${sender}</div><div>${escapeHtml(text)}</div><div class="small" style="margin-top:6px; text-align:right;">${(new Date()).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
    chatBody.appendChild(r);
    chatBody.scrollTop = chatBody.scrollHeight;
  }
  function escapeHtml(s){ return (s+'').replace(/[&<>"'`]/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;', '`':'&#96;' })[m]); }

  sendChatBtn.addEventListener('click', ()=> {
    const txt = chatInput.value.trim();
    if (!txt) return;
    appendChat(username || 'Me', txt, true);
    if (socket) socket.emit('chatMessage', { sender: username, text: txt });
    chatInput.value = '';
  });
  chatInput.addEventListener('keypress', (e)=> { if (e.key === 'Enter') sendChatBtn.click(); });

  // Socket events (if available)
  if (socket) {
    socket.on('connect', ()=> console.log('socket connected'));
    socket.on('message', (data)=> {
      // data expected { sender, text }
      appendChat(data.sender || 'Anon', data.text || '');
    });
    socket.on('onlineCount', (n)=> { onlineCountEl.innerText = n; });
    socket.on('chatMessage', (data)=> { appendChat(data.sender||'Anon', data.text||''); });
  }

  // Small helpers
  document.getElementById('muteBtn').addEventListener('click', ()=>{
    video.muted = !video.muted;
    document.getElementById('muteBtn').innerHTML = video.muted ? '<i class="fas fa-volume-xmark"></i>' : '<i class="fas fa-volume-high"></i>';
  });

  // keyboard: space toggles play for desktop dev
  window.addEventListener('keydown', (e)=> {
    if (e.code === 'Space') { e.preventDefault(); togglePlay(); }
    else if (e.code === 'KeyM') { video.muted = !video.muted; }
  });

  // small UX: hide controls after few seconds of inactivity (on mobile)
  let controlTimer;
  function showControlsTemporarily() {
    document.getElementById('controls').style.opacity = '1';
    centerPlayContainer.style.display = video.paused ? 'flex' : 'none';
    clearTimeout(controlTimer);
    controlTimer = setTimeout(()=> {
      document.getElementById('controls').style.opacity = '0.0';
      if (video.paused) centerPlayContainer.style.display = 'flex';
    }, 3500);
  }
  // initial show
  showControlsTemporarily();
  document.getElementById('videoArea').addEventListener('touchstart', showControlsTemporarily);
  document.getElementById('videoArea').addEventListener('mousemove', showControlsTemporarily);

  // small visual spin keyframes
  const s = document.createElement('style'); s.innerHTML = '@keyframes spin { to { transform: rotate(360deg); } }'; document.head.appendChild(s);

  // Optional: autoplay muted on mobile friendly
  try { video.volume = 0.8; } catch(e) {}

  // preload poster or test
  video.addEventListener('error', ()=> {
    videoStatus.innerText = 'Error loading video';
  });

  // If socket not present, show offline note in chat
  if (!socket) {
    appendChat('System', 'Realtime chat not available (no socket.io server). Use local mode.', false);
  }

})(); // IIFE
</script>
</body>
</html>
